local skinData = {
    --[id] = {nationality(1-európai/ 2-amerikai/ 3-ázsiai / 4-afrikai), nem (1 - férfi/2 - nő), frakcióSkin, CustomSkin}
    [1] = {1, 1},
    [2] = {1, 1},
	[7] = {4, 1},
    [9] = {4, 2},
    [10] = {2, 2},
    [11] = {4, 2},
    [12] = {2, 2},
    [13] = {4, 2},
    [14] = {4, 1},
    [15] = {1, 1},
    [16] = {4, 1},
    [17] = {4, 1},
    [18] = {4, 1},
    [19] = {4, 1},
    [20] = {4, 2},
    [21] = {4, 1},
    [22] = {2, 1},
    [23] = {1, 1},
    [24] = {4, 1},
    [25] = {4, 1},
    [26] = {1, 1},
    [27] = {2, 1},
    [28] = {2, 1},
    [29] = {1, 1},
    [30] = {2, 1},
    [31] = {2, 2},
    [32] = {2, 1},
    [33] = {4, 1},
    [34] = {2, 1},
    [35] = {4, 1},
    [36] = {2, 1},
    [37] = {1, 1},
    [38] = {2, 2},
    [39] = {1, 2},
    [40] = {4, 2},
    [41] = {2, 2},
    [43] = {2, 1},
    [44] = {2, 1},
    [45] = {1, 1},
    [46] = {1, 1},
    [47] = {4, 1},
    [48] = {1, 1},
    [49] = {3, 1},
    [50] = {2, 1, true},
    [51] = {2, 1},
    [52] = {1, 1},
    [53] = {1, 2},
    [54] = {1, 2},
    [55] = {1, 2},
    [56] = {1, 2},
    [57] = {3, 1},
    [58] = {2, 1},
    [59] = {1, 1},
    [60] = {1, 1},
    [61] = {2, 1},
    [62] = {1, 1},
    [63] = {1, 2},
    [64] = {4, 1, true},
    [66] = {4, 1},
    [67] = {2, 1, true},
    [68] = {1, 1},
    [69] = {4, 2},
    [70] = {1, 1},
    [71] = {2, 1, true},
    [72] = {1, 1},
    [73] = {1, 1, true},
    [75] = {2, 1, true},
    [76] = {2, 1, true},
    [77] = {2, 1, true},
    [78] = {2, 1},
    [79] = {2, 1},
    [80] = {2, 1, true},
    [81] = {2, 1, true},
    [82] = {2, 1, true},
    [83] = {2, 1, true},
    [84] = {4, 1},
    [85] = {1, 2},
    [87] = {1, 2},
    [88] = {1, 2},
    [89] = {1, 2},
    [90] = {2, 2},
    [91] = {1, 2},
    [92] = {2, 2},
    [93] = {1, 2},
    [94] = {2, 1},
    [95] = {2, 1, true},
    [96] = {1, 1},
    [97] = {1, 1},
    [98] = {2, 1},
    [99] = {2, 1},
    [100] = {2, 1},
    [101] = {1, 1},
    [102] = {4, 1},
    [103] = {4, 1},
    [104] = {4, 1},
    [105] = {4, 1},
    [106] = {4, 1},
    [107] = {4, 1},
    [108] = {2, 1},
    [109] = {2, 1},
    [110] = {1, 1},
    [111] = {2, 1},
    [112] = {1, 1},
    [113] = {2, 1},
    [114] = {2, 1},
    [115] = {2, 1},
    [116] = {1, 1},
    [117] = {1, 1},
    [118] = {3, 1},
    [120] = {1, 1},
    [121] = {1, 1},
    [122] = {1, 1},
    [123] = {4, 1},
    [124] = {2, 1},
    [125] = {1, 1},
    [126] = {1, 1},
    [127] = {1, 1},
    [128] = {2, 1},
    [129] = {2, 2},
    [130] = {2, 2},
    [131] = {4, 2},
    [132] = {1, 1},
    [133] = {2, 1, true},
    [134] = {4, 1},
    [135] = {2, 1, true},
    --[136] = {2, 1},
    [137] = {2, 1},
    [138] = {2, 2, true},
    [139] = {4, 2},
    [140] = {2, 2},
    [141] = {2, 2},
    [142] = {4, 1},
    [143] = {4, 1},
    [144] = {4, 1},
    [145] = {2, 2},
    [146] = {2, 1},
    [147] = {1, 1},
    [148] = {4, 2},
    [150] = {2, 2},
    [151] = {2, 2},
    [152] = {1, 2},
    [153] = {2, 1, true},
    [154] = {1, 1},
    [155] = {1, 1},
    [156] = {4, 1},
    [157] = {2, 2},
    [158] = {2, 1},
    [159] = {2, 1},
    [160] = {2, 1, true},
    [161] = {2, 1},
    [162] = {2, 1, true},
    [163] = {4, 1},
    [164] = {2, 1},
    [165] = {1, 1},
    [166] = {4, 1},
    [167] = {1, 1},
    [168] = {4, 1},
    [169] = {3, 2},
    [170] = {2, 1},
    [171] = {1, 1},
    [172] = {1, 2},
    [173] = {2, 1},
    [174] = {2, 1},
    [175] = {2, 1},
    [176] = {4, 1},
    [177] = {2, 1},
    [178] = {1, 2},
    [179] = {2, 1},
    [180] = {4, 1},
    [181] = {2, 1, true},
    [182] = {4, 1},
    [183] = {4, 1},
    [184] = {2, 1},
    [185] = {1, 1},
    [186] = {1, 1},
    [187] = {2, 1},
    [188] = {1, 1},
    [189] = {1, 1},
    [190] = {4, 2},
    [191] = {1, 2},
    [192] = {1, 2},
    [193] = {3, 2},
    [194] = {2, 2},
    [195] = {4, 2},
    [196] = {2, 2},
    [197] = {2, 2},
    [198] = {2, 2},
    [199] = {1, 2, true},
    [200] = {2, 1},
    [201] = {1, 2},
    [202] = {1, 1},
    [203] = {3, 1},
    [204] = {1, 1},
    [205] = {2, 2},
    [206] = {2, 1, true},
    [207] = {4, 2},
    [209] = {2, 1},
    [210] = {3, 1},
    [211] = {2, 2},
    [212] = {2, 1},
    [213] = {2, 1},
    [214] = {4, 2},
    [215] = {4, 2},
    [216] = {1, 2},
    [217] = {2, 1},
    [218] = {4, 2},
    [219] = {4, 2},
    [220] = {4, 1},
    [221] = {4, 1},
    [222] = {4, 1},
    [223] = {2, 1},
    [224] = {3, 2},
    [225] = {3, 2},
    [226] = {1, 2},
    [227] = {2, 1, true},
    [228] = {2, 1, true},
    [229] = {3, 1},
    [230] = {2, 1},
    [231] = {1, 2},
    [232] = {1, 2},
    [233] = {2, 2},
    [234] = {3, 1},
    [235] = {1, 1},
    [236] = {2, 1, true},
    [237] = {2, 2},
    [238] = {4, 2},
    [239] = {2, 1},
    [240] = {2, 1},
    [241] = {1, 1},
    [242] = {2, 1},
    [243] = {4, 2},
    [244] = {4, 2},
    [245] = {4, 2},
    [246] = {1, 2},
    [247] = {2, 1},
    [248] = {2, 1, true},
    [249] = {4, 1, true},
    [250] = {1, 1},
    [251] = {4, 1, true},
    [252] = {2, 1, true},
    [253] = {4, 1, true},
    [254] = {1, 1},
    [255] = {4, 1, true},
    [256] = {2, 2, true},
    [257] = {2, 2, true},
    [258] = {2, 1},
    [259] = {1, 1},
    [260] = {4, 1, true},
    --[261] = {2, 1, false, true},
    [262] = {4, 1},
    [263] = {3, 2},
    [264] = {4, 1, true},
    [265] = {4, 1, true},
    [266] = {2, 1, true},
    [267] = {1, 1, true},
    [268] = {1, 1},
    [269] = {4, 1},
    [270] = {4, 1},
    [271] = {2, 1, true},
    --[272] = {2, 1, true},
    [274] = {2, 1, true},
    [275] = {4, 1, true},
    [276] = {2, 1, true},
    [277] = {1, 1},
    [278] = {4, 1},
    [279] = {2, 1},
    [280] = {2, 1, true},
    [281] = {4, 1, true},
    [282] = {3, 1, true},
    [283] = {4, 1, true},
    [284] = {2, 1, true},
    [285] = {2, 1, true},
    [286] = {4, 1, true},
    [287] = {2, 2, true},
    [288] = {1, 1, true},
    --[290] = {2, 1, false, true},
    [291] = {1, 1},
    [292] = {2, 1},
    [293] = {4, 1},
    [294] = {2, 1},
    [295] = {1, 1},
    [296] = {4, 1},
    [297] = {4, 1},
    [298] = {2, 2},
    [299] = {2, 2},
    [300] = {2, 1, true},
    [301] = {1, 1},
    [302] = {4, 1, true},
    [303] = {1, 1},
    [304] = {1, 1},
    [305] = {2, 1},
    [306] = {2, 2, true},
    [307] = {4, 2, true},
    [308] = {2, 1},
    [309] = {1, 2, true},
    [310] = {2, 1, true},
    [311] = {2, 1, true},
    [312] = {4, 1},
	
	--animals
	[65] = {1, 2, false, true},
	[5] = {1, 2, false, true},
	[4] = {1, 2, false, true},
	[3] = {1, 2, false, true},
}

local skinByNationality = {}
for k,v in pairs(skinData) do 
    if not skinByNationality[v[1]] then 
        skinByNationality[v[1]] = {}
    end 

    if not skinByNationality[v[1]][v[2]] then 
        skinByNationality[v[1]][v[2]] = {}
    end 

    if not v[3] and not v[4] then 
        table.insert(skinByNationality[v[1]][v[2]], k)
    end
end 

function generateRandomSkin(a, b)
    if skinByNationality[a] and skinByNationality[a][b] then 
        return skinByNationality[a][b][math.random(1, #skinByNationality[a][b])]
    end 
end 

function getAvailableSkins(a, b)
    if skinByNationality[a] and skinByNationality[a][b] then 
        return skinByNationality[a][b]
    end 
end 

local permData = {
   --[id] = serial / table with serials such as: {["asd"] = true, ["asd"] = true}
    ["000"] = {["261"]=true},
}

addEventHandler("onClientElementDataChange", localPlayer,
    function(dName, oValue)
        if dName == "char >> skin" then
            checkSkin(source, dName, oValue)
        elseif dName == "char >> details" then
            checkSkin(source, false, false)
        end
    end
)

function checkSkin(source, dName, oValue)
    if not oValue then
        if dName then 
            oValue = source:getData(dName) or source.model
        else 
            oValue = source.model
        end
    end
   --outputChatBox(dName)
    local value = dName and source:getData(dName) or source.model
    local a = source:getData("char >> details")
    local nationality = a["nationality"]
    local typ = a["neme"]
   --outputChatBox(typ)
   --outputChatBox(value)
    if not skinData[value] then return end
    
   --outputChatBox("asd1")
    local a2 = skinData[value][1] or 0
    local a3 = skinData[value][2] or 0

    if skinData[value][3] then-- frakció skin
        return
    end

    if dName then 
        if skinData[value][4] then 
            local syntax = exports.cr_core:getServerSyntax("SkinProtect", "error")

            setTimer(setElementData, 250, 1, source, dName, oValue)
            outputChatBox(syntax .. "A kinézeted (model) vissza lett változtatva a régire, hisz az új nem használható, mivel védett.", 255, 0, 0, true)
            return
        end
    end

    if a2 ~= nationality and a2 ~= "*" then
        local syntax = exports['cr_core']:getServerSyntax("SkinProtect", "error")
        outputChatBox(syntax .. "A kinézeted (model) át lett változtatva egy véletlenszerűre, hisz az új nem használható a jelenlegi nemzetiségednél.", 255,255,255,true)

        local dataName = dName and dName or "char >> skin"

        source:setData(dataName, generateRandomSkin(nationality, typ))
        return
    elseif a3 ~= typ and a3 ~= "*" then
        local syntax = exports['cr_core']:getServerSyntax("SkinProtect", "error")
        outputChatBox(syntax .. "A kinézeted (model) át lett változtatva egy véletlenszerűre, hisz az új nem használható a jelenlegi nemeddel.", 255,255,255,true)

        local dataName = dName and dName or "char >> skin"

        source:setData(dataName, generateRandomSkin(nationality, typ))
        return
    end

   --outputChatBox("asd2")
    local perm = permData[value]
    if perm then
        local serial = perm
       --outputChatBox(type(serial))
        if type(serial) == "table" then
            local hasPerm = perm[getElementData(localPlayer, "mtaserial")]
            if exports['cr_core']:getPlayerDeveloper(localPlayer) then
                hasPerm = true
            end

            if not hasPerm then
                local syntax = exports['cr_core']:getServerSyntax("SkinProtect", "error")
                outputChatBox(syntax .. "A kinézeted (model) vissza lett változtatva a régire, hisz az új nem használható mert nincs megfelelő jogosultságod a használatára.", 255,255,255,true)
                source:setData(dName, oValue)
            end
        elseif type(serial) == "number" then
            local hasPerm = getElementData(localPlayer, "mtaserial") == serial
            if exports['cr_core']:getPlayerDeveloper(localPlayer) then
                hasPerm = true
            end

            if not hasPerm then
                local syntax = exports['cr_core']:getServerSyntax("SkinProtect", "error")
                outputChatBox(syntax .. "A kinézeted (model) vissza lett változtatva a régire, hisz az új nem használható mert nincs megfelelő jogosultságod a használatára.", 255,255,255,true)
                source:setData(dName, oValue)
            end
        end
    end
end

addEventHandler("onClientResourceStart", resourceRoot,
    function()
        if localPlayer:getData("loggedIn") then
            local a = localPlayer:getData("char >> details")
            local nationality = a["nationality"]
            local typ = a["neme"]
            checkSkin(localPlayer, "char >> skin", generateRandomSkin(nationality, typ))
        end
    end
)